~(f.variable_create;name=categorypath;type=TEXT;when=NEVER)
~(f.variable_create;name=fullpath;type=TEXT;when=NEVER)
~(f.variable_create;name=voidbuffer;type=TEXT;when=NEVER)
~(f.variable_create;name=buffer2;type=TEXT;when=NEVER)
~(f.variable_create;name=filehandle;type=TEXT;when=NEVER)
~(f.variable_create;name=category;type=TEXT;when=NEVER)
~(f.variable_create;name=uniqueidx;type=INT;when=NEVER)
~(f.variable_set;name=uniqueidx;value=0)
~[f.array;name=folderlist;fn=create;delim=,;elem_type=TEXT;value=~[f.file;fn=folderlist;path={{customdatadir}}web_root\admin\reports\;delim=,;]]
{"categories":[
~[duplicate;~[f.array;name=folderlist;fn=count];qq;count;counterstart=1]
~(f.variable_set;name=categorypath;value={{customdatadir}}web_root\admin\reports\~[f.array;name=folderlist;fn=value;index=qq]\;)
~(f.variable_set;name=category;value=~[f.array;name=folderlist;fn=value;index=qq];)
~[if#foldertest.~[f.file;fn=test;path=~(v.categorypath)]#-43]
~[if#skipcat.~[f.array;name=folderlist;fn=value;index=qq]#c_reportmanager]
{"name":"~(v.category)","reports":[~[x:insertfile;crm_filehelper_json.html]]}~[if#jsonhandler.~[f.array;name=folderlist;fn=count]=qq][else#jsonhandler],[/if#jsonhandler]
[/if#skipcat]
[/if#foldertest]
~[if#endcat.~[f.array;name=folderlist;fn=count]=qq]]}[/if#endcat]
[/duplicate]